---
date: 2025-08-19
readtime: 5 
title: 
description: 
---

## Planned Tasks

- [x] Begin mapping out motor circuit and parts
- [x] Decide on which parts to use


## Motor Circuit

**Initial Design:**
![[Pasted image 20250819161045.png]]

**Notes:**
- D1 is a SS34 (3A) Schottky diode
	- It has a nice low forward voltage of 0.2-0.5V and fast switching
- MOTOR_3.7V and MOTOR_GROUD are isolated lines from the ESP32 power

**Further Research Notes:**
- Confirm that the current flows into the motor from the anode, into the drain, and out the source
- Confirm that when Q1 switches off, the current goes through D1 back into the power source
- Look into a gate resistor
- Look into a gate to source resistor

### Resistors

**Gate resistor (R1)**
- Lowers ringing and EMI
	- The GPIO pin has inductance and the MOSFET acts like a capacitor. This forms an LC circuit that can ring
- Protects ESP32 from surge currents
	- Instantaneous current is large when applying voltage step to capacitor
- 22 ohm is a good starting point

**Gate to source resistor (R2)**
- Defines the "off" state for the MOSFET
	- Drains charge away when the ESP32 is off, bringing it to near 0V
- Bleeds any static charge back to the source
- 100kOhm is a good starting point

### Modified circuit:

![[Pasted image 20250819162945.png]]


### Final Speed Controller Circuit:

![[Pasted image 20250819210247.png]]




## Power and Isolation

Looking online, it seems that isolating the two power circuits for the ESP32 and motors will be crucial for preventing noise and spikes from damaging the ESP32. Additionally, I will have to prepare for any other voltage spikes that the Schottky diodes can't handle.

A TVS diode seems like the best solution to prevent voltage spikes from affecting the whole board overall. These are like a safety valve and clamp onto certain voltages to prevent damage. The working voltage should be under the breakdown voltage, and the clamping voltage should be under the maximum voltage of all components on my board. 

From research, the MOSFETs I will be using can handle a maximum of 30V and the Schottky diodes have a reverse bias of 40V. My ESP32 can only handle voltages between 3.0-3.6V. This may be a problem as the power source is rated 3.7V, but can go from 3.0-4.2V depending on charge level. I will probably need a sort of voltage regulator to ensure the voltage stays around 3.3V. This will introduce another component.

**ESP Voltage Regulator**
Since the voltage of the battery can swing above and below the 3.3V I want, it seems like a buck-boost voltage regulator will be needed. This can boost the voltage or buck the voltage to the 3.3V I want, and will be easy to manage if I can find a fixed version with output 3.3V. However, I will also need to ensure that the current it can provide is at least 0.5A, the "peak" ESP32 current. 

Looking online, I've decided on the TPS63001, which has a fixed 3.3V output, 1.7A max current, and 1.8-5.5V input voltage. This will help to regulate the ESP32 voltage, and also provide another buffer against spikes from the motors. However, since the max is 5.5V for the input, the TVR will have to have a clamping voltage less than this.

**TVR Diode**
Initially, I was looking at the SMAJ5.0A, which can handle reverse voltage of 5V, breakdown voltage of 6.4-7V, and max clamping voltage of 9.2V. However, with the addition of the voltage regulator, I will probably have to find one that can clamp at less than 5V.

**Power Isolation and Stability**
To isolate the two power rails, I will have to make sure that none of the power/ground leads from each sector mix around, and only connect to the battery at a single point. Additionally, to prevent sudden current losses from spikes, I will have to have a couple capacitor banks to have reserve power. I will probably have one after the voltage regulator for the ESP32, and a large one at the battery output for the entire circuit.

**Motor Voltage**
When I saw that the battery can fluctuate between 3.0-4.2V, this worried me as I didn't know if the motors can handle this change in voltage as they are rated for 3.7V. However, looking online it seems to be fine as it will just change it's RPM as long as it doesn't exceed it's limit. Additionally, I went through to make sure that the voltage drop from the MOSFET doesn't affect the average voltage that the motor receives, which I found to be in the tens of millivolts based on the running current and MOSFET resistance. This is not significant, so it should be fine. 


### Power Circuit 

![[Pasted image 20250819211926.png]]